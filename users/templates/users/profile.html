{% extends "base_main.html" %}

{% load products_tags %}
{% load static %}

{% block main %}
  <div class="ui centered massive header">üë§ User Profile</div>


      <div class="ui segment profile-section">
        <div class="ui grid">
          <div class="thirteen wide column">
            <p><strong>Firstname:</strong> {{ user.first_name }}</p>
            <p><strong>Lastname:</strong> {{ user.last_name }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
      {% if user.phone %}
            <p><strong>Phone:</strong> {{ user.phone }}</p>
            {% endif %}
      {% if user.address %}
            <p><strong>Address:</strong> {{ user.address.address_field1 }}, {% if user.address.address_field2 %}{{ user.address.address_field2 }},{% endif %} 
              {{ user.address.city }}, {% if user.address.state %}{{ user.address.state }},{% endif %} {{ user.address.country }}, {{ user.address.postal_code }}</p>
              {% endif %}
          </div>
          <div class="three wide column right aligned">
            <a class="ui blue icon button" href="{% url "users:user_edit" %}">
              <i class="edit icon"></i> <span class="only computer">Edit Profile</span>
            </a>
          </div>
        </div>
      </div>
  
    <section id="profile-tabs">
      {% comment %} <div class="tabs mb-3">
        {% if products %}
        <a href="?{% change_params tab='favourites' %}">
            <button class="tab-button {% if request.GET.tab == 'favourites' or not request.GET.tab %}active{% endif %}" data-tab="favourites">Favourites</button>
        </a>
        {% endif %}
        {% if cart.cart_total_quantity > 0 %}
        <a href="?{% change_params tab='cart' %}">
            <button class="tab-button {% if request.GET.tab == 'cart' %}active{% endif %}" data-tab="cart">Cart</button>
        </a>
        {% endif %}
        {% if completed_orders %}
        <a href="?{% change_params tab='orders' %}">
            <button class="tab-button {% if request.GET.tab == 'orders' %}active{% endif %}" data-tab="orders">Completed orders</button>
        </a>
        {% endif %}
      </div> {% endcomment %}



      <div class="ui top attached tabular menu">
        {% if products %}
        <a href="?{% change_params tab='favourites' %}" class="{% if request.GET.tab == 'favourites' or not request.GET.tab %}active{% endif %} item" data-tab="favourites">‚ù§Ô∏è Favourites</a>
        {% endif %}
        {% if cart.cart_total_quantity > 0 %}
        <a href="?{% change_params tab='cart' %}" class="{% if request.GET.tab == 'cart' %}active{% endif %} item" data-tab="cart">üõí Cart</a>
        {% endif %}
        {% if completed_orders %}
        <a href="?{% change_params tab='orders' %}" class="{% if request.GET.tab == 'orders' %}active{% endif %} item" data-tab="orders">üì¶ Orders</a>
        {% endif %}
        <a href="?{% change_params tab='user_products' %}" class="{% if request.GET.tab == 'user_products' %}active{% endif %} item" data-tab="user_products">üîß Your products</a>
        {% if other_actions %}
        <a href="?{% change_params tab='other_actions' %}" class="{% if request.GET.tab == 'other_actions' %}active{% endif %} item" data-tab="other_actions">Other actions</a>
        {% endif %}
        {% if news %}
        <a href="?{% change_params tab='news' %}" class="{% if request.GET.tab == 'news' %}active{% endif %} item" data-tab="news">üì∞ News</a>
        {% endif %}
      </div>




      <div class="tab-content">
        {% if products %}
        <div class="ui bottom attached {% if request.GET.tab == 'favourites' or not request.GET.tab %}active{% endif %} tab segment" data-tab="favourites">
  <div class="ui large header">Your Favourite Products

  </div>

          {% include "products/components/_favourite_list.html" %}
        </div>
        {% endif %}

        {% if cart.cart_total_quantity > 0 %}
          <div class="ui bottom attached {% if request.GET.tab == 'cart' %}active{% endif %} tab segment" data-tab="cart">
  <div class="ui large header">Your Cart</div>

            {% include "carts/components/_cart_products.html" %}
            <div class="cart-summary" style="margin-top: 1rem;">
              <p>Total products quantity: <strong>{{ cart.cart_total_quantity }}</strong></p>
                <p>Total price: <strong>${{ cart.cart_total_price }}</strong></p>
              </div>
        </div>
        {% endif %}

        {% if completed_orders %}
  <div class="ui bottom attached {% if request.GET.tab == 'orders' %}active{% endif %} tab segment" data-tab="orders">

  <div class="ui large header">Completed Orders</div>

 
  <div class="ui styled fluid accordion">
  {% for order in completed_orders %}
  <div class="title">
    <i class="dropdown icon"></i>
    <strong>Order #{{ order.order_number }}</strong> ‚Äî <span>üìÖ {{ order.date_completed|date:"d.m.Y" }}</span> ‚Äî 
    <span><strong>Total:</strong> ${{ order.cart_total_price }}</span>
  </div>
  <div class="content">
    <div class="ui bulleted list">
      {% for ordered_product in order.ordered.all %}
          {% if ordered_product.quantity > 0 %}
          <div class="item">
            <strong>{{ ordered_product.product.title }}</strong> ‚Äî ${{ ordered_product.product.full_price }} √ó {{ ordered_product.quantity }} = <strong>${{ ordered_product.total_price }}</strong>
          </div>
          {% endif %}
          {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>
</div>
{% endif %}




<div class="ui bottom attached {% if request.GET.tab == 'user_products' %}active{% endif %} tab segment" data-tab="user_products">
  <button class="ui primary button" id="open-product-modal">
    <i class="plus icon"></i> Add product
  </button>
  <div class="ui large header">Your Added Products</div>
  {% with user_products as products  %}
  {% if not products %}
  <p>You have not added any products yet</p>
  {% else %}
  {% include "products/components/_product_list.html" with is_user_products=True %}
  {% endif %}
  {% endwith %}
        </div>

        {% if other_actions %}
        <div class="ui bottom attached {% if request.GET.tab == 'other_actions' %}active{% endif %} tab segment" data-tab="other_actions">
  <div class="ui large header">Other actions</div>

  <div class="ui feed">
    {% for action in other_actions %}
      <div class="event">
        <div class="content">
          <div class="summary">
            <strong>{{action.user.email}}</strong>
            {% if action.verb == 'liked' %}
              liked your product
            {% elif action.verb == 'purchased' %}
              purchased your product
            {% endif %}
            <a href="{{ action.target.get_absolute_url }}">{{ action.target.title }}</a>
            <div class="date">{{ action.created|timesince }} ago</div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

        </div>
        {% endif %}

        {% if news %}
        <div class="ui bottom attached {% if request.GET.tab == 'news' %}active{% endif %} tab segment" data-tab="news">
  <div class="ui large header">News</div>
  <div class="ui three stackable cards">
    {% for product in news %}
    {% include "products/components/_news_card.html" %}
    {% endfor %}
  </div>

        </div>
        {% endif %}






      </div>
    </section>

    <div class="ui modal" id="product-modal">
      <div class="header">
        <i class="add icon"></i> Add a product
      </div>
        {% include "products/components/_product_form.html" %}
  
    </div>
{% endblock main %}

{% block additional_script %}
<script src='{% static "js/toggle_completed_orders.js" %}'></script>
<script src="{% static "js/profile.js" %}""></script>
{% endblock additional_script %}
