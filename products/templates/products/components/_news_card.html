{% load products_tags %}
{% load main_tags %}
{% load static %}
{% static 'images/placeholder.png' as IMG_PLACEHOLDER %}

<div class="ui fluid card product-card">
  <div class="image" style="background:#f8f8f8;">
    <a href="{{ product.get_absolute_url }}">
      <img loading="lazy"
           src="{{ product.first_photo|default:IMG_PLACEHOLDER }}"
           alt="{{ product.title }}"
           style="object-fit:cover; width:100%; height:200px;">
    </a>
    {% if product.updated_at and product.updated_at|date:"U" > product.created_at|date:"U" %}
      <div class="ui top right attached label"
           title="Last updated: {{ product.updated_at|date:'Y-m-d H:i' }}">
        Updated {{ product.updated_at|days_since }} ago
      </div>
    {% endif %}
  </div>

  <div class="content">
    <div class="header" style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;">
      <a href="{{ product.get_absolute_url }}">{{ product.title }}</a>
      <div class="meta" style="font-weight:400;">
        in <a href="{{ product.category.get_absolute_url }}">{{ product.category.name }}</a>
      </div>
    </div>

    {% if product.brand %}
    <div class="meta" style="margin-top:.25rem;">
      Brand:
      <a href="{{ product.brand.get_absolute_url }}">{{ product.brand.name }}</a>
    </div>
    {% endif %}

    <div class="description" style="margin-top:.6rem;">
      {% if product.discount %}
        <div class="price-block" style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;">
          <span class="ui tiny grey text" style="text-decoration:line-through;">
            ${{ product.price }}
          </span>
          <span class="ui tiny green label">-{{ product.discount }}%</span>
          <strong>${{ product.full_price }}</strong>
        </div>
      {% else %}
        <div><strong>${{ product.price }}</strong></div>
      {% endif %}
      {% if product.summary %}
        <p style="margin-top:.4rem;opacity:.9;">{{ product.summary }}</p>
      {% else %}
        <p style="margin-top:.4rem;opacity:.9;">{{ product.description|default_if_none:""|truncatewords:18 }}</p>
      {% endif %}
    </div>

    {% if product.tags.all %}
    <div class="meta" style="margin-top:.6rem;">
      <div class="ui mini labels" style="display:flex;gap:.25rem;flex-wrap:wrap;">
        {% for tag in product.tags.all %}
          {% if tag.display %}
          <div class="ui label">#{{ tag.name }}</div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>

  <div class="extra content" style="display:flex;justify-content:space-between;align-items:center;gap:.5rem;flex-wrap:wrap;">
    <div class="left">
      <span class="ui small text">SKU: {{ product.sku }}</span>
    </div>
    <div class="right">
      {% with updated=product.updated_at|date:"U" created=product.created_at|date:"U" %}
        {% if updated and created and updated|add:"-604800"|floatformat:0 < created|add:"0" or updated|add:"-604800" < updated %}
        {% endif %}
      {% endwith %}
    </div>
  </div>
</div>
