{% extends "base_main.html" %}
{% load i18n %}
{% block main %}
  <div class="ui massive centered header"><i class="shopping cart icon"></i>{% trans "Cart" %}</div>
  <div class="ui stackable grid">
    <div class="eleven wide column">
      {% include "carts/components/_cart_products.html" %}
    </div>
    <div class="five wide column">
      <div class="summary-box">
        <h3 class="ui header">Final information</h3>
        <p>Total products quantity: <strong>{{ cart.cart_total_quantity }}</strong></p>
        <p>Total price: <strong>${{ cart.cart_total_price }}</strong></p>

        {% if request.user.is_authenticated and cart.cart_total_quantity > 0 %}
        <form class="ui form" method="post" action="{% url 'coupons:apply' %}">
          {% csrf_token %}
          <div class="field">
            <label>Apply a coupon</label>
            <div class="ui action input">
              {{ coupon_apply_form.code }}
              <button type="submit" class="ui teal button">Apply</button>
            </div>
          </div>
        </form>
        {% endif %}

        {% if cart.coupon %}
        <div class="ui teal message">
          <div class="header">
            Coupon applied: <strong>{{cart.coupon.code}}</strong>
          </div>
          <p>You saved <strong>{{cart.coupon.discount}}%</strong> on your order!</p>
          <p>Discount amount: <strong>${{cart.cart_discount}}</strong></p>
        </div>
      
        <div class="ui large yellow segment">
          <h4 class="ui header">Final price after discount</h4>
          <p class="ui big green text">
            <strong>${{cart.cart_total_price_after_discount}}</strong>
          </p>
        </div>
        {% endif %}


        {% if cart.cart_total_quantity > 0 %}
          <a
            {% if disable_payment %}
              class="ui primary checkout disabled button"
              href="#"
              title="Adjust quantities to proceed to checkout"
            {% else %}
              class="ui primary checkout button"
              href="{% url 'carts:checkout' %}"
            {% endif %}
          >
            Checkout
          </a>
        {% else %}
          <button class="ui primary checkout disabled button" aria-disabled="true">
            Checkout
          </button>
        {% endif %}
      </div>
    </div>

    {% if recommended_products %}
    <div class="recommended-products sixteen wide column" style="margin-top:1rem;">
      <div class="ui large header">{% trans "People who bought this also like" %}</div>
      {% with specific_products=recommended_products %}
      {% include "products/components/_specific_products_list.html" with list_title="People who bought this also like" %}
      {% endwith %}
    </div>
    {% endif %}
  </div>

{% endblock main %}
